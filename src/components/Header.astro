---
/* src/components/Header.astro */

import Icon from '../components/Icon.astro';

const whatWeDoCols = [
  {
    title: 'Delivery & Growth',
    items: [
      {
        name: 'Work Unblocked',
        href: '/work-unblocked',
        desc: 'Remove blockers and get stalled work moving again.',
      },
      {
        name: 'Mission Control',
        href: '#services',
        desc: 'We help run your most important initiative end-to-end.',
      },
      {
        name: 'Launch & Learn',
        href: '#services',
        desc: 'Ship fast, validate, and iterate with real users.',
      },
    ],
  },
  {
    title: 'Leadership & Foundation',
    items: [
      {
        name: 'Product Leadership on Tap',
        href: '#services',
        desc: 'Fractional senior product/delivery leadership.',
      },
      {
        name: 'Team Accelerator',
        href: '#services',
        desc: 'Build a delivery rhythm your teams can sustain.',
      },
      {
        name: 'LaunchPad',
        href: '#services',
        desc: 'Lightweight web/marketing foundations to get seen.',
      },
    ],
  },
];

const differenceCols = [
  {
    title: 'The Reignite Edge',
    items: [
      {
        name: 'Outcomes First',
        href: '/outcomes-first',
        desc: 'We measure success by shipped value, not slides.',
      },
      {
        name: 'Hands-On Delivery',
        href: '/hands-on-delivery',
        desc: 'We don’t just advise — we execute.',
      },
      {
        name: 'Jargon-Free',
        href: '/jargon-free',
        desc: 'Straightforward, transparent communication.',
      },
    ],
  },
  {
    title: 'Focus & Clarity',
    items: [
      {
        name: 'Who We Serve',
        href: '/who-we-serve',
        desc: 'UK teams with ambition, pace, and complexity.',
      },
      {
        name: 'Our Process',
        href: '/outcomes-first#the-model',
        desc: 'Diagnose, prioritise, deliver, embed.',
      },
      {
        name: 'Meet the Founder',
        href: '/meet-the-founder',
        desc: 'Product/delivery background, Yorkshire-based.',
      },
    ],
  },
];
---
<header class="sticky top-0 z-50 bg-surface/95 backdrop-blur border-b border-ink/5 shadow-sm">
  <div class="container-reignite flex justify-between items-center h-20 gap-6">
    <!-- BRAND -->
    <a href="/" class="group flex items-center gap-4" aria-label="Reignite Solutions home">
      <img
        src="/assets/brand/logo-web.png"
        alt="Reignite Solutions logo"
        class="h-14 w-14 object-contain rounded-md"
        loading="eager"
      />
      <div class="leading-tight">
        <span class="block font-display text-lg md:text-xl font-bold text-ink tracking-tight">
          Reignite Solutions
        </span>
        <span class="block text-sm md:text-base text-ink/70">
         Clarity. Momentum. Results.
        </span>
      </div>
    </a>

    <!-- DESKTOP NAV -->
    <nav class="hidden md:flex items-center gap-6" aria-label="Primary navigation">
      <!-- WHAT WE DO (MEGA) -->
      <div class="relative nav-dropdown-wrapper" data-dropdown>
        <button
          class="flex items-center gap-2 text-base md:text-lg font-medium text-ink hover:text-accent transition"
          type="button"
          data-dropdown-trigger
          aria-haspopup="true"
          aria-expanded="false"
          aria-label="Open What We Do menu"
        >
          What We Do
          <svg
            class="w-4 h-4 transition-transform duration-200"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
        </button>

        <div
          class="nav-dropdown absolute left-1/2 -translate-x-1/2 top-full mt-3 w-[900px]
                 bg-surface border border-ink/5 rounded-xl shadow-2xl p-8 z-40"
          data-dropdown-panel
        >
          <div class="grid grid-cols-3 gap-8">
            {whatWeDoCols.map((col) => (
              <div>
                <h4
                  class="text-sm font-bold uppercase text-accent mb-4 tracking-wider border-b border-accent/20 pb-2"
                >
                  {col.title}
                </h4>
                <ul class="space-y-3">
                  {col.items.map((item) => (
                    <li>
                      <a href={item.href} class="block group/item">
                        <span class="block text-base font-semibold text-ink group-hover/item:text-accent">
                          {item.name}
                        </span>
                        <span class="block text-xs text-ink/50 mt-1 leading-snug">
                          {item.desc}
                        </span>
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            ))}

            <!-- RIGHT-HAND CARD -->
            <div class="bg-ink/5 rounded-lg p-6 flex flex-col justify-between">
              <div>
                <h4 class="text-lg font-display font-semibold text-ink mb-2">
                  Got a different problem?
                </h4>
                <p class="text-sm text-ink/70">
                  If it doesn’t fit neatly into a service, we can scope it with you.
                </p>
              </div>
              <a
                href="/contact"
                class="mt-4 mb-8 inline-flex items-center justify-center px-4 py-2 rounded-md bg-accent text-white text-sm font-semibold hover:bg-black transition shadow-md hover:shadow-lg uppercase tracking-wide"
              >
                Talk to us
              </a>
              <!-- telephone -->
              <a
                href="tel:+447352050404"
                class="flex items-center gap-2 text-sm text-ink/70 hover:text-ink transition"
              >
                <Icon name="phone-outgoing" class="w-5 h-5 text-ink/70" alt="Telephone" />
                +44 (0)735 20 50 404
              </a>

              <!-- email -->
              <a
                href="mailto:hello@reignites.co.uk"
                class="flex items-center gap-2 text-sm text-ink/70 hover:text-ink transition"
              >
                <Icon name="at-sign" class="w-5 h-5 text-ink/70" alt="Email" />
                hello@reignites.co.uk
              </a>
            </div>
          </div>
          <a
            href="/services"
            class="block text-center pt-4 mt-6 border-t border-ink/5 text-sm font-semibold text-ink hover:text-accent"
          >
            View full services overview &raquo;
          </a>
        </div>
      </div>

      <!-- OUR DIFFERENCE -->
      <div class="relative nav-dropdown-wrapper" data-dropdown>
        <button
          class="flex items-center gap-2 text-base md:text-lg font-medium text-ink hover:text-accent transition"
          type="button"
          data-dropdown-trigger
          aria-haspopup="true"
          aria-expanded="false"
          aria-label="Open Our Difference menu"
        >
          Our Difference
          <svg
            class="w-4 h-4 transition-transform duration-200"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
        </button>

        <div
          class="nav-dropdown absolute left-1/2 -translate-x-1/2 top-full mt-3 w-[520px]
                 bg-surface border border-ink/5 rounded-xl shadow-2xl p-8 z-40"
          data-dropdown-panel
        >
          <div class="grid grid-cols-2 gap-6">
            {differenceCols.map((col) => (
              <div>
                <h4
                  class="text-sm font-bold uppercase text-accent mb-4 tracking-wider border-b border-accent/20 pb-2"
                >
                  {col.title}
                </h4>
                <ul class="space-y-3">
                  {col.items.map((item) => (
                    <li>
                      <a href={item.href} class="block group/item">
                        <span class="block text-base font-semibold text-ink group-hover/item:text-accent">
                          {item.name}
                        </span>
                        <span class="block text-xs text-ink/50 mt-1 leading-snug">
                          {item.desc}
                        </span>
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </div>
          <a
            href="/our-difference"
            class="block text-center pt-4 mt-6 border-t border-ink/5 text-sm font-semibold text-ink hover:text-accent"
          >
            Explore our approach &raquo;
          </a>
        </div>
      </div>

      <!-- CTA -->
      <a
        href="/contact"
        class="flex items-center gap-2 px-5 py-2 rounded-lg text-white font-bold tracking-wide
               bg-accent hover:bg-black transition shadow-md hover:shadow-lg text-sm md:text-base"
      >
        Let's talk
      </a>
    </nav>

    <!-- MOBILE NAV -->
    <details class="md:hidden relative">
      <summary class="list-none cursor-pointer rounded p-2 hover:bg-ink/5">
        <span class="sr-only">Open navigation</span>
        <div class="w-6 h-0.5 bg-ink mb-1"></div>
        <div class="w-6 h-0.5 bg-ink mb-1"></div>
        <div class="w-6 h-0.5 bg-ink"></div>
      </summary>
      <div
        class="absolute right-0 mt-3 w-72 bg-surface border border-ink/5 rounded-lg shadow-lg p-4 space-y-3 z-50"
      >
        <div>
          <p class="text-xs uppercase tracking-wide text-ink/50 mb-2">What We Do</p>
          <div class="pl-2 border-l border-ink/10 space-y-1">
            {whatWeDoCols.flatMap((col) =>
              col.items.map((item) => (
                <a href={item.href} class="block text-sm text-ink/80 hover:text-accent">
                  {item.name}
                </a>
              ))
            )}
          </div>
        </div>
        <div>
          <p class="text-xs uppercase tracking-wide text-ink/50 mb-2">Our Difference</p>
          <div class="pl-2 border-l border-ink/10 space-y-1">
            {differenceCols.flatMap((col) =>
              col.items.map((item) => (
                <a href={item.href} class="block text-sm text-ink/80 hover:text-accent">
                  {item.name}
                </a>
              ))
            )}
          </div>
        </div>
        <a
          href="/contact"
          class="block text-center mt-2 px-4 py-2 bg-accent text-white rounded-md font-semibold uppercase tracking-wide"
        >
          Contact us
        </a>
      </div>
    </details>
  </div>

  <!-- Tiny dropdown controller -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const dropdowns = document.querySelectorAll('[data-dropdown]');

      dropdowns.forEach((wrapper) => {
        const trigger = wrapper.querySelector('[data-dropdown-trigger]');
        const panel = wrapper.querySelector('[data-dropdown-panel]');
        let closeTimeout = null;

        const open = () => {
          clearTimeout(closeTimeout);
          wrapper.classList.add('is-open');
          if (trigger) trigger.setAttribute('aria-expanded', 'true');
        };

        const close = () => {
          closeTimeout = setTimeout(() => {
            wrapper.classList.remove('is-open');
            if (trigger) trigger.setAttribute('aria-expanded', 'false');
          }, 150);
        };

        trigger?.addEventListener('mouseenter', open);
        panel?.addEventListener('mouseenter', open);

        trigger?.addEventListener('mouseleave', close);
        panel?.addEventListener('mouseleave', close);

        // keyboard/focus support
        trigger?.addEventListener('focus', open);
        panel?.addEventListener('focusin', open);
        trigger?.addEventListener('blur', close);
        panel?.addEventListener('focusout', close);
      });
    });
  </script>
</header>

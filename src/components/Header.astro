---
/* src/components/Header.astro */

import "../styles/global.css";

const whatWeDoCols = [
  {
    title: 'Delivery & Growth',
    items: [
      { name: 'Work Unblocked', href: '/work-unblocked', desc: 'Remove blockers and get stalled work moving again.' },
      { name: 'Mission Control', href: '/mission-control', desc: 'We help run your most important initiative end-to-end.' },
      { name: 'Launch & Learn', href: '/launch-and-learn', desc: 'Ship fast, validate, and iterate with real users.' },
    ],
  },
  {
    title: 'Leadership & Foundation',
    items: [
      { name: 'Product Leadership on Tap', href: '/leadership-on-tap', desc: 'Fractional senior product/delivery leadership.' },
      { name: 'Team Accelerator', href: '/team-accelerator', desc: 'Build a delivery rhythm your teams can sustain.' },
      { name: 'LaunchPad', href: '/launchpad', desc: 'Lightweight web/marketing foundations to get seen.' },
    ],
  },
];

const differenceCols = [
  {
    title: 'How we work',
    items: [
      { name: 'Outcomes First', href: '/outcomes-first', desc: 'Start with the result, then pick the work.' },
      { name: 'Hands-On Delivery', href: '/hands-on-delivery', desc: 'We don’t just advise. We sit in the work.' },
      { name: 'Jargon-Free', href: '/jargon-free', desc: 'Straightforward, transparent communication.' },
    ],
  },
  {
    title: 'Who it’s for',
    items: [
      { name: 'Who We Serve', href: '/who-we-serve', desc: 'Teams with ambition, pace, and complexity.' },
      { name: 'Our Difference overview', href: '/our-difference', desc: 'Why Reignite exists and what makes us different.' },
      { name: 'Meet the Team', href: '/meet-the-team', desc: 'Product/delivery background, Yorkshire-based.' },
    ],
  },
];
---

<header class="sticky top-0 z-50 bg-surface/95 supports-[backdrop-filter]:backdrop-blur border-b border-ink/5">
  <div class="container-reignite flex justify-between items-center h-16 md:h-20 gap-4">
    <!-- BRAND -->
    <a href="/" class="group flex items-center gap-3" aria-label="Reignite Solutions home">
      <img src="/assets/brand/logo-web.png" alt="Reignite Solutions logo" class="h-10 w-10 md:h-14 md:w-14 object-contain rounded-md" loading="eager" />
      <div class="leading-tight">
        <span class="block font-display text-base md:text-xl font-bold text-ink tracking-tight">Reignite Solutions</span>
        <span class="hidden md:block text-sm text-ink/70">Clarity. Momentum. Results.</span>
      </div>
    </a>

    <!-- DESKTOP NAV (mega menus) -->
    <nav class="hidden md:flex items-center gap-6" aria-label="Primary navigation">
      <!-- WHAT WE DO -->
      <div class="relative nav-dropdown-wrapper" data-dropdown>
        <button
          class="flex items-center gap-2 text-base font-medium text-ink hover:text-accent transition"
          type="button"
          aria-haspopup="true"
          aria-expanded="false"
          data-dropdown-trigger
        >
          What We Do
          <svg class="w-4 h-4 transition-transform duration-200" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
        </button>

        <div
          class="nav-dropdown absolute left-1/2 -translate-x-1/2 top-full mt-3 w-[900px] bg-surface border border-ink/5 rounded-xl shadow-2xl p-8 z-40"
          data-dropdown-panel
        >
          <div class="grid grid-cols-3 gap-8">
            {whatWeDoCols.map((col) => (
              <div>
                <h4 class="text-sm font-bold uppercase text-accent mb-4 tracking-wider border-b border-accent/20 pb-2">{col.title}</h4>
                <ul class="space-y-3">
                  {col.items.map((item) => (
                    <li>
                      <a href={item.href} class="block group/item">
                        <span class="block text-base font-semibold text-ink group-hover/item:text-accent">{item.name}</span>
                        <span class="block text-xs text-ink/50 mt-1 leading-snug">{item.desc}</span>
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            ))}

            <!-- Side card -->
            <div class="bg-ink/5 rounded-lg p-6 flex flex-col justify-between">
              <div>
                <h4 class="text-lg font-display font-semibold text-ink mb-2">Got a different problem?</h4>
                <p class="text-sm text-ink/70">If it doesn’t fit neatly into a service, we can scope it with you.</p>
              </div>
              <a href="/contact" class="mt-4 inline-flex items-center justify-center px-4 py-2 rounded-md bg-accent text-white text-sm font-semibold hover:bg-black transition shadow-md hover:shadow-lg uppercase tracking-wide">
                Let's chat
              </a>
            </div>
          </div>
          <a href="/services" class="block text-center pt-4 mt-6 border-t border-ink/5 text-sm font-semibold text-ink hover:text-accent">
            View full services overview &raquo;
          </a>
        </div>
      </div>

      <!-- OUR DIFFERENCE -->
      <div class="relative nav-dropdown-wrapper" data-dropdown>
        <button
          class="flex items-center gap-2 text-base font-medium text-ink hover:text-accent transition"
          type="button"
          aria-haspopup="true"
          aria-expanded="false"
          data-dropdown-trigger
        >
          Our Difference
          <svg class="w-4 h-4 transition-transform duration-200" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
        </button>

        <div
          class="nav-dropdown absolute left-1/2 -translate-x-1/2 top-full mt-3 w-[900px] bg-surface border border-ink/5 rounded-xl shadow-2xl p-8 z-40"
          data-dropdown-panel
        >
          <div class="grid grid-cols-3 gap-8">
            {differenceCols.map((col) => (
              <div>
                <h4 class="text-sm font-bold uppercase text-accent mb-4 tracking-wider border-b border-accent/20 pb-2">{col.title}</h4>
                <ul class="space-y-3">
                  {col.items.map((item) => (
                    <li>
                      <a href={item.href} class="block group/item">
                        <span class="block text-base font-semibold text-ink group-hover/item:text-accent">{item.name}</span>
                        <span class="block text-xs text-ink/50 mt-1 leading-snug">{item.desc}</span>
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            ))}

            <!-- Side card -->
            <div class="bg-ink/5 rounded-lg p-6 flex flex-col justify-between">
              <div>
                <h4 class="text-lg font-display font-semibold text-ink mb-2">New to Reignite?</h4>
                <p class="text-sm text-ink/70">Start with Outcomes First, then explore who we serve.</p>
              </div>
              <a href="/outcomes-first" class="mt-4 inline-flex items-center justify-center px-4 py-2 rounded-md bg-accent text-white text-sm font-semibold hover:bg-black transition shadow-md hover:shadow-lg uppercase tracking-wide">
                Read Outcomes First
              </a>
            </div>
          </div>
          <a href="/our-difference" class="block text-center pt-4 mt-6 border-t border-ink/5 text-sm font-semibold text-ink hover:text-accent">
            Explore our approach &raquo;
          </a>
        </div>
      </div>

      <!-- CTA -->
      <a href="/contact" class="flex items-center gap-2 px-5 py-2 rounded-lg text-white font-bold tracking-wide uppercase bg-accent hover:bg-black transition shadow-md hover:shadow-lg text-sm md:text-base">
        Contact us
      </a>
    </nav>

    <!-- MOBILE: hamburger (SVG for consistency) -->
    <button
      id="mobile-open"
      class="md:hidden inline-flex items-center justify-center p-2 rounded hover:bg-ink/5"
      aria-controls="mobile-menu"
      aria-expanded="false"
      aria-label="Open menu"
    >
      <svg class="h-6 w-6 text-ink" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" role="img" aria-hidden="true">
        <title>Open menu</title>
        <path stroke-linecap="round" d="M4 7h16M4 12h16M4 17h16" />
      </svg>
    </button>
  </div>
</header>

<!-- MOBILE MENU (full-screen) -->
<div id="mobile-menu" class="mobile-menu" data-open="false" aria-hidden="true">
  <div class="mobile-menu__panel" role="dialog" aria-modal="true" aria-labelledby="mobile-menu-title">
    <!-- Top bar -->
    <div class="flex items-center justify-between h-16 px-4 border-b border-ink/10">
      <span id="mobile-menu-title" class="font-display font-semibold text-lg text-ink">Menu</span>
      <button id="mobile-close" class="p-2 rounded hover:bg-ink/5" aria-label="Close menu">
        <svg class="h-6 w-6 text-ink" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 6l12 12M18 6L6 18" />
        </svg>
      </button>
    </div>

    <!-- Content -->
    <nav class="p-4 space-y-8">
      <!-- Quick links -->
      <div class="grid grid-cols-2 gap-3">
        <a href="/services" class="btn-pill">Services</a>
        <a href="/our-difference" class="btn-pill">Our Difference</a>
        <a href="/who-we-serve" class="btn-pill">Who We Serve</a>
        <a href="/contact" class="btn-pill btn-pill--accent">Contact</a>
      </div>

      <!-- Accordions -->
      <section class="space-y-4">
        <details class="menu-acc" data-acc>
          <summary class="menu-acc__summary">What We Do</summary>
          <ul class="menu-list">
            {whatWeDoCols.flatMap((col) =>
              col.items.map((item) => (
                <li><a class="menu-link" href={item.href}>{item.name}</a></li>
              ))
            )}
          </ul>
        </details>

        <details class="menu-acc" data-acc>
          <summary class="menu-acc__summary">Our Difference</summary>
          <ul class="menu-list">
            {differenceCols.flatMap((col) =>
              col.items.map((item) => (
                <li><a class="menu-link" href={item.href}>{item.name}</a></li>
              ))
            )}
          </ul>
        </details>

        <details class="menu-acc" data-acc>
          <summary class="menu-acc__summary">More</summary>
          <ul class="menu-list">
            <li><a class="menu-link" href="/privacy">Privacy Policy</a></li>
            <li><a class="menu-link" href="/terms">Terms &amp; Conditions</a></li>
            <li><a class="menu-link" href="/cookies">Cookie Policy</a></li>
            <li><a class="menu-link" href="/careers">Careers</a></li>
          </ul>
        </details>
      </section>

      <!-- CTA -->
      <a href="/contact" class="block w-full text-center px-4 py-3 rounded-md bg-accent text-white font-semibold uppercase tracking-wide shadow-md hover:bg-black">
        Contact us
      </a>
    </nav>
  </div>

  <!-- Overlay -->
  <button id="mobile-overlay" class="mobile-menu__overlay" aria-hidden="true" tabindex="-1"></button>
</div>

<!-- Behaviour: desktop dropdowns + mobile menu -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    /* Desktop mega menus */
    document.querySelectorAll('[data-dropdown]').forEach((wrapper) => {
      const trigger = wrapper.querySelector('[data-dropdown-trigger]');
      const panel = wrapper.querySelector('[data-dropdown-panel]');
      let closeTimeout = null;

      const open = () => {
        clearTimeout(closeTimeout);
        wrapper.classList.add('is-open');
        trigger?.setAttribute('aria-expanded', 'true');
      };
      const close = () => {
        closeTimeout = setTimeout(() => {
          wrapper.classList.remove('is-open');
          trigger?.setAttribute('aria-expanded', 'false');
        }, 120);
      };

      trigger?.addEventListener('mouseenter', open);
      panel?.addEventListener('mouseenter', open);
      trigger?.addEventListener('mouseleave', close);
      panel?.addEventListener('mouseleave', close);
      trigger?.addEventListener('focus', open);
      panel?.addEventListener('focusin', open);
      trigger?.addEventListener('blur', close);
      panel?.addEventListener('focusout', close);
    });

    /* Mobile */
    const root = document.getElementById('mobile-menu');
    const panel = root.querySelector('.mobile-menu__panel');
    const overlay = document.getElementById('mobile-overlay');
    const openBtn = document.getElementById('mobile-open');
    const closeBtn = document.getElementById('mobile-close');

    const focusable = () =>
      panel.querySelectorAll('a, button, summary, input, select, textarea, [tabindex]:not([tabindex="-1"])');

    function openMenu() {
      root.dataset.open = 'true';
      root.setAttribute('aria-hidden', 'false');
      document.body.classList.add('overflow-hidden');
      openBtn.setAttribute('aria-expanded', 'true');

      // Accordion: only one open at a time
      panel.querySelectorAll('[data-acc]').forEach((el) => {
        el.addEventListener('toggle', () => {
          if (el.open) {
            panel.querySelectorAll('[data-acc]').forEach((sib) => { if (sib !== el) sib.open = false; });
          }
        });
      });

      const first = focusable()[0];
      first && first.focus();
    }

    function closeMenu() {
      root.dataset.open = 'false';
      root.setAttribute('aria-hidden', 'true');
      document.body.classList.remove('overflow-hidden');
      openBtn.setAttribute('aria-expanded', 'false');
      openBtn.focus();
    }

    // Trap focus
    panel.addEventListener('keydown', (e) => {
      if (e.key !== 'Tab') return;
      const nodes = Array.from(focusable());
      if (!nodes.length) return;
      const first = nodes[0], last = nodes[nodes.length - 1];
      if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
      else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
    });

    openBtn?.addEventListener('click', openMenu);
    closeBtn?.addEventListener('click', closeMenu);
    overlay?.addEventListener('click', closeMenu);
    document.addEventListener('keydown', (e) => e.key === 'Escape' && root.dataset.open === 'true' && closeMenu());
  });
</script>
---
import CtaLink from './CtaLink.astro';

interface Props {
  // GA4 Tracking & Link Attributes
  href?: string;
  category?: string; // REQUIRED if href is present, for GA4 tracking.
  label?: string;    // REQUIRED if href is present, for GA4 tracking.
  target?: string;
  rel?: string;

  // Styling Context
  context?: 'light' | 'dark'; // The background color the button is sitting on
  variant?: 'primary' | 'secondary' | 'ghost'; // Hierarchy

  // Visuals & Type
  class?: string;
  size?: 'small' | 'medium';
  type?: 'submit' | 'button' | 'reset';
  disabled?: boolean;
  
  // Custom event handler
  onClick?: string;
}

const { 
  href, 
  category, 
  label, 
  class: className,
  context = 'light', // Default is white background (light)
  variant = 'primary', 
  size = 'medium',
  type = 'button', 
  disabled = false,
  target,
  rel,
  onClick,
} = Astro.props;

// --- Styling Logic (Corrected Border Management) ---
// Base classes DO NOT include a border-color or border-width globally
const baseClasses = 'inline-flex items-center justify-center font-semibold rounded-md transition duration-200 tracking-wide'; 
let variantClasses = '';
let sizeClasses = '';

// Size Logic
switch (size) {
    case 'small':
        sizeClasses = 'px-3 py-1.5 text-xs';
        break;
    case 'medium':
    default:
        sizeClasses = 'px-5 py-2 text-sm md:text-base';
        break;
}

if (variant === 'primary') {
    if (context === 'light') {
        // RULE 1: Red Primary on Light Background (No visible border)
        // We add a transparent border to prevent layout shift on hover.
        variantClasses = 'bg-accent text-white hover:bg-black hover:text-white border-2 border-transparent';
    } else {
        // RULE 2: White Primary on Dark Background (Border appears ONLY on hover)
        variantClasses = 'bg-white text-ink hover:bg-transparent hover:text-white hover:border-white border-2 border-transparent';
    }
} else if (variant === 'secondary') {
    if (context === 'light') {
        // RULE 3: Secondary on Light Background (Dark border)
        variantClasses = 'bg-transparent text-ink border-2 border-ink hover:bg-ink/10';
    } else {
        // RULE 3: Secondary on Dark Background (White border)
        variantClasses = 'bg-transparent text-white border-2 border-white hover:bg-white/10';
    }
} else { // ghost or other
    // Low-emphasis style
    variantClasses = 'bg-transparent text-ink hover:text-accent font-normal tracking-normal p-0 border-none';
}


const finalClasses = `${baseClasses} ${sizeClasses} ${variantClasses} ${className || ''}`;
---

{href && category && label ? (
  <CtaLink 
    href={href} 
    category={category}
    label={label}
    class={finalClasses}
    target={target}
    rel={rel}
    aria-disabled={disabled}
  >
    <slot />
  </CtaLink>
) : (
  <button 
    class={finalClasses} 
    type={type} 
    disabled={disabled}
    onclick={onClick}
  >
    <slot />
  </button>
)}
---
// src/pages/local-offer.astro

import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import CookieConsent from '../components/CookieConsent.astro';
import Button from '../components/Button.astro';
import CtaLink from '../components/CtaLink.astro';

import {
  Sparkles,
  Zap,
  MessageCircle,
  CheckCircle2,
  MapPin,
  Clock,
  BadgePercent,
  Hammer,
} from '@lucide/astro';

import {
  offerLive,
  totalSlots,
  slotsRemaining,
  discountPercent,
  eligiblePlaces,
  quickStartPacks,
  otherServicesNote
} from '../data/local-offer.config';

const pageTitle = 'Local Offer | Ilkley & Nearby | Reignite Solutions';
const pageDesc =
  'A one-time local hello deal for businesses within 5 miles of Ilkley. Shockingly good pricing on new sites, refreshes, and all Reignite services.';

const ogImage = '/assets/social/og-50off_v2.jpg';

const slotsUsed = Math.max(0, totalSlots - slotsRemaining);
const percentUsed = Math.min(100, Math.round((slotsUsed / totalSlots) * 100));

const iconMap = {
  Sparkles,
  Zap,
  CheckCircle2,
  Hammer,
};

// Simple helper
const plural = (n) => (n === 1 ? '' : 's');
---

<BaseLayout
  title={pageTitle}
  description={pageDesc}
  canonical="https://www.reignites.co.uk/local-offer/"
  ogImage={ogImage}
>
  <Header />

  <main class="text-ink">
    {/* HERO */}
    <section class="pt-28 md:pt-32 pb-16 bg-gradient-to-b from-white via-surface to-white relative overflow-hidden">
      <div class="container-reignite max-w-6xl grid gap-10 md:grid-cols-[1.1fr_0.9fr] items-center">
        <div class="space-y-6">
          <span
            class={`inline-flex items-center gap-2 text-[11px] font-semibold uppercase tracking-[0.25em] px-4 py-1 rounded-full ${
              offerLive ? 'bg-accent/10 text-accent' : 'bg-ink/10 text-ink'
            }`}
          >
            <BadgePercent class="w-3.5 h-3.5" aria-hidden="true" />
            Local hello offer
          </span>

          <h1 class="text-4xl md:text-6xl font-display font-extrabold leading-tight tracking-tight">
            Ilkley area?
            <br />
            Get some proper work for half price.
          </h1>

          <p class="text-lg md:text-xl text-ink/75 max-w-2xl">
            We’re new round here, so we’re doing something a bit mad.
            If your business is within 5 miles of Ilkley town centre, you get
            <strong class="text-ink"> {discountPercent}% off one project</strong>.
            New website from scratch, refresh an old one, or any Reignite service. Your call.
          </p>

          <div class="flex flex-wrap gap-3 pt-2">
            <Button
              href="/local-offer-apply"
              category="LOCAL_OFFER_HERO"
              label="CLAIM_OFFER"
              context="light"
            >
              <MessageCircle class="w-5 h-5" aria-hidden="true" />
              Claim the local offer
            </Button>

            <Button
              href="#eligibility"
              category="LOCAL_OFFER_HERO"
              label="CHECK_ELIGIBILITY"
              context="light"
              variant="secondary"
            >
              <MapPin class="w-4 h-4" aria-hidden="true" />
              Check if you qualify
            </Button>
          </div>
        </div>

        <div class="relative">
          <div
            class={`rounded-2xl p-7 md:p-8 shadow-xl border space-y-5 ${
              offerLive ? 'bg-ink text-white border-white/10' : 'bg-surface text-ink border-ink/10'
            }`}
          >
            <p class={`text-xs uppercase tracking-[0.2em] ${offerLive ? 'text-white/60' : 'text-ink/60'}`}>
              Availability
            </p>

            {offerLive ? (
              <>
                <div class="space-y-2">
                  <div class="flex items-center justify-between text-sm">
                    <span class="font-semibold text-white">Slots remaining</span>
                    <span class="text-white/80">
                      {slotsRemaining} of {totalSlots}
                    </span>
                  </div>

                  <div class="h-3 rounded-full bg-white/10 overflow-hidden border border-white/10">
                    <div
                      class="h-full bg-accent transition-none"
                      style={`width: ${percentUsed}%;`}
                      aria-hidden="true"
                    ></div>
                  </div>

                  <p class="text-sm text-white/80">
                    Once they’re gone, they’re gone. We keep the team tiny on purpose.
                  </p>
                </div>

                <ul class="space-y-3 text-base text-white/90 pt-2">
                  <li class="flex gap-2">
                    <CheckCircle2 class="w-5 h-5 text-white shrink-0" aria-hidden="true" />
                    {discountPercent}% off one project for local businesses
                  </li>
                  <li class="flex gap-2">
                    <CheckCircle2 class="w-5 h-5 text-white shrink-0" aria-hidden="true" />
                    One project per business, first come first served
                  </li>
                  <li class="flex gap-2">
                    <CheckCircle2 class="w-5 h-5 text-white shrink-0" aria-hidden="true" />
                    Same senior delivery, no “local version”
                  </li>
                </ul>
              </>
            ) : (
              <>
                <p class="text-lg font-semibold">
                  This offer is closed.
                </p>
                <p class="text-sm text-ink/70">
                  We’ve filled all {totalSlots} local slots. If you still want help, get in touch and we’ll quote straight.
                </p>
                <Button href="/contact" category="LOCAL_OFFER_CLOSED" label="CONTACT_US" context="light">
                  Talk to us
                </Button>
              </>
            )}
          </div>

          <div class="pointer-events-none absolute -top-10 -right-10 w-40 h-40 bg-accent/10 rounded-full blur-2xl float-slow"></div>
          <div class="pointer-events-none absolute -bottom-12 -left-12 w-56 h-56 bg-ink/5 rounded-full blur-3xl float-fast"></div>
        </div>
      </div>
    </section>

    {/* QUICK START PACKS */}
    <section class="py-16 bg-white">
      <div class="container-reignite max-w-6xl space-y-10">
        <div class="space-y-3 max-w-3xl">
          <h2 class="text-3xl font-display font-semibold">Local quick-start packages</h2>
          <p class="text-lg text-ink/70">
            Half price for one project. Pick a quick-start pack, or use it on any other service.
          </p>
        </div>

        <div class="grid gap-6 md:grid-cols-2">
          {quickStartPacks.map((pack) => {
            const Icon = iconMap[pack.iconKey];
            return (
              <article
                class={`relative bg-surface rounded-2xl border p-7 space-y-4 hover:shadow-md transition ${
                  pack.highlight ? 'border-accent/50 ring-1 ring-accent/20' : 'border-ink/10'
                }`}
              >
                {pack.popular && (
                <span class="absolute left-1/2 -translate-x-1/2 -top-3 bg-ink text-white text-[10px] font-bold uppercase tracking-wider px-3 py-1 rounded-full z-10">
                  Most popular
                </span>
                )}

                <div class="flex items-start justify-between gap-4">
                  <div class="space-y-1">
                    <h3 class="text-xl font-semibold">{pack.name}</h3>
                    <p class="text-sm text-ink/70">{pack.desc}</p>
                  </div>
                  <Icon class="w-6 h-6 text-ink shrink-0" aria-hidden="true" />
                </div>

                <div class="flex flex-wrap items-baseline gap-3">
                  <p class="text-sm text-ink/60 line-through">{pack.before}</p>
                  <p class="text-2xl font-bold text-ink">{pack.after}</p>
                  <p class="text-xs text-ink/60">one-time local price</p>
                </div>

                <p class="text-sm text-ink/70 flex items-center gap-2">
                  <Clock class="w-4 h-4 text-ink/60" aria-hidden="true" />
                  {pack.timeline}
                </p>

                <CtaLink
                  href={pack.href}
                  category="LOCAL_OFFER_PACK"
                  label={pack.name.toUpperCase().replace(/\s+/g, '_')}
                  class="inline-flex items-center gap-2 text-sm font-semibold text-ink hover:text-accent"
                >
                  View details →
                </CtaLink>
              </article>
            );
          })}
        </div>

        <div class="bg-ink/5 rounded-xl p-6 border border-ink/10 text-sm text-ink/80">
          {otherServicesNote}
        </div>
      </div>
    </section>

    {/* ELIGIBILITY */}
    <section id="eligibility" class="py-16 bg-surface scroll-mt-24 md:scroll-mt-28">
      <div class="container-reignite max-w-6xl space-y-8">
        <div class="space-y-3 max-w-3xl">
          <h2 class="text-3xl font-display font-semibold">Eligibility</h2>
          <p class="text-lg text-ink/70">
            Offer applies to businesses primarily based in any of these places (within 5 miles of Ilkley town centre):
          </p>
        </div>

        <ul class="grid gap-3 sm:grid-cols-2 md:grid-cols-3 text-sm text-ink/80">
          {eligiblePlaces.map((place) => (
            <li class="bg-white rounded-lg border border-ink/10 hover:border-accent px-4 py-3">
              {place}
            </li>
          ))}
        </ul>

        <div class="pt-4">
          <Button
            href="/local-offer-apply"
            category="LOCAL_OFFER_ELIGIBILITY"
            label="APPLY_NOW"
            context="light"
          >
            <MessageCircle class="w-5 h-5" aria-hidden="true" />
            Apply for the local offer
          </Button>
        </div>
      </div>
    </section>

    {/* FAQ */}
    <section class="py-16 bg-ink">
      <div class="container-reignite max-w-6xl space-y-8">
        <h2 class="text-3xl font-display font-semibold text-white">FAQ</h2>

        <div class="grid gap-6 md:grid-cols-2">
          <div class="bg-white rounded-xl border border-ink/10 p-6 space-y-2">
            <h3 class="font-semibold">What counts as a “project”?</h3>
            <p class="text-sm text-ink/70">
              One defined piece of work agreed in writing, like a small new website, a refresh, or a single Reignite service.
            </p>
          </div>

          <div class="bg-white rounded-xl border border-ink/10 p-6 space-y-2">
            <h3 class="font-semibold">How do slots work?</h3>
            <p class="text-sm text-ink/70">
              First come, first served. When slots hit zero, the offer closes automatically on the site.
            </p>
          </div>

          <div class="bg-white rounded-xl border border-ink/10 p-6 space-y-2">
            <h3 class="font-semibold">Can I use this on any service?</h3>
            <p class="text-sm text-ink/70">
              Yes, on any one Reignite service. You choose the work. We apply the discount once.
            </p>
          </div>

          <div class="bg-white rounded-xl border border-ink/10 p-6 space-y-2">
            <h3 class="font-semibold">How long does the discount last?</h3>
            <p class="text-sm text-ink/70">
              It’s a one-time hello. You book the project under the offer, we lock the price for that project only.
            </p>
          </div>
        </div>
      </div>
    </section>

    {offerLive && slotsRemaining > 0 && (
      <section class="py-12 bg-white">
        <div class="container-reignite max-w-6xl">
          <div class="bg-surface border border-ink/10 rounded-xl p-6">
            <h2 class="text-lg font-semibold mb-3">Local offer terms (short version)</h2>
            <ul class="text-xs text-ink/70 grid gap-2 md:grid-cols-2 list-disc pl-4">
              <li>Offer is one-time, per business, on one project only.</li>
              <li>Cannot be combined with any other discount or charity rate.</li>
              <li>Only applies to businesses primarily based within 5 miles of Ilkley town centre.</li>
              <li>Slots are limited to {totalSlots}. Once filled, offer ends.</li>
              <li>Final scope and price confirmed in writing before work starts.</li>
              <li>Reignite can pause or withdraw the offer at any time before booking confirmation.</li>
            </ul>
            <p class="text-[11px] text-ink/50 mt-3">
              Full terms are on the Terms &amp; Conditions page.
            </p>
          </div>
        </div>
      </section>
    )}

  </main>

  <Footer />
  <CookieConsent />

  <style>
    @keyframes floatSlow {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(12px); }
    }
    @keyframes floatFast {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    .float-slow { animation: floatSlow 8s ease-in-out infinite; }
    .float-fast { animation: floatFast 6s ease-in-out infinite; }

    @media (prefers-reduced-motion: reduce) {
      .float-slow, .float-fast { animation: none; }
    }
  </style>
</BaseLayout>